<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Dialectical Bridge - Tri·∫øt h·ªçc 4.0</title>
    <link rel="stylesheet" href="main.css?v=11">
    <script>
        // T·ª± ƒë·ªông redirect sang intro.html n·∫øu kh√¥ng ƒë·∫øn t·ª´ intro v√† kh√¥ng ph·∫£i ch∆°i l·∫°i
        const fromIntro = sessionStorage.getItem('from_intro');
        const restartGame = sessionStorage.getItem('restart_game');
        
        if (!fromIntro && !restartGame) {
            window.location.href = 'intro.html'; 
        }
        
        // X√≥a restart_game flag sau khi ƒë√£ ki·ªÉm tra
        if (restartGame) {
            sessionStorage.removeItem('restart_game');
        }
    </script>
</head>
<body>
    <div id="main-menu" class="hidden">
        <div class="menu-content">
            <h1 class="game-title">üåâ The Dialectical Bridge</h1>
            <h2 class="game-subtitle">Tri·∫øt h·ªçc 4.0</h2>
            <p class="game-description">H√†nh tr√¨nh t·ª´ Ti·ªÉu h·ªçc ƒë·∫øn ƒê·∫°i h·ªçc</p>
            <button id="start-button" onclick="startGame()">START</button>
            <div class="game-info">
                <p>üéØ 16 c·∫•p ƒë·ªô th·ª≠ th√°ch</p>
                <p>üìö T√≠ch l≈©y L∆Ø·ª¢NG ƒë·ªÉ th·ª±c hi·ªán b∆∞·ªõc nh·∫£y CH·∫§T</p>
                <p>‚ö†Ô∏è C·∫©n th·∫≠n v·ªõi ƒêi·ªÉm N√∫t!</p>
            </div>
        </div>
    </div>

    <div id="game-container" class="bg-chapter-0">
        <div id="ui-layer">
            <h2 id="level-name">Ti·ªÉu H·ªçc C∆° S·ªü - L·ªõp 1</h2>
            <p id="instruction">Nh·∫•n gi·ªØ chu·ªôt ƒë·ªÉ t√≠ch l≈©y L∆Ø·ª¢NG (ƒë·ªô d√†i c·∫ßu)</p>
            <div id="score-board">
                C·∫•p ƒë·ªô: <span id="score">1 / 16</span> | 
                M·∫°ng: <span id="lives-display">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
            </div>
        </div>

        <div id="world">
            <div id="bg-pillars">
                <div class="bg-pillar" style="left: 30%; height: 150px; width: 60px;"></div>
                <div class="bg-pillar" style="left: 50%; height: 180px; width: 50px;"></div>
                <div class="bg-pillar" style="left: 70%; height: 140px; width: 55px;"></div>
                <div class="bg-pillar" style="left: 85%; height: 160px; width: 45px;"></div>
            </div>
            <div id="player">üë∂</div>
            <div id="countdown-display"></div>
            
            <div id="dialogue-notification">
                <div id="dialogue-text"></div>
                <button id="dialogue-skip" style="display: none; margin-top: 10px; padding: 8px 20px; background: #ffd700; color: #2c3e50; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">B·ªè qua ‚è©</button>
            </div>
            
            <div id="bridge"></div>
            <div id="pillar-container">
                <div id="passed-pillars"></div>
                <div id="pillar-current" class="pillar"></div>
                <div id="pillar-next" class="pillar"></div>
            </div>
        </div>

        <div id="message-overlay" class="hidden">
            <div class="message-content">
                <h1 id="msg-title"></h1>
                <p id="msg-desc"></p>
                <button onclick="handleRetry()">Th·ª≠ l·∫°i (R√∫t kinh nghi·ªám)</button>
            </div>
        </div>

        <div id="quiz-overlay" class="hidden">
            <div class="quiz-content">
                <h2 id="quiz-title">K·ª≤ thi Chuy·ªÉn c·∫•p</h2>
                <div id="quiz-timer">‚è±Ô∏è Th·ªùi gian: <span id="time-left">0</span>s</div>
                <div id="quiz-progress">C√¢u <span id="current-question">1</span> / <span id="total-questions">0</span></div>
                <div id="question-container">
                    <p id="question-text"></p>
                    <div id="answers-container"></div>
                </div>
                <button id="submit-answer" onclick="submitAnswer()" disabled>Ti·∫øp theo</button>
            </div>
        </div>

        <div id="tutorial-overlay" class="hidden">
            <div class="tutorial-content">
                <h2 id="tutorial-title"></h2>
                <div id="tutorial-progress">B∆∞·ªõc <span id="tutorial-step">1</span> / <span id="tutorial-total">3</span></div>
                <p id="tutorial-text"></p>
                <button id="tutorial-next" onclick="nextTutorialStep()">Ti·∫øp theo ‚û°Ô∏è</button>
            </div>
        </div>
    </div>

    <script src="dialogues.js"></script>
    <script src="main.js"></script>
    
    <script>
        // H√†m n√†y n√™n ƒë∆∞·ª£c g·ªçi trong main.js m·ªói khi bi·∫øn level tƒÉng l√™n
        function updateGameBackground(currentLevel) {
            const container = document.getElementById('game-container');
            
            // X√≥a h·∫øt c√°c class background c≈©
            container.classList.remove('bg-chapter-0', 'bg-chapter-1', 'bg-chapter-2', 'bg-chapter-3');

            // Logic chia c·∫•p h·ªçc (Mapping level to chapter)
            if (currentLevel <= 5) {
                // Ti·ªÉu h·ªçc (Level 1-5)
                container.classList.add('bg-chapter-0');
            } else if (currentLevel <= 9) {
                // THCS (Level 6-9)
                container.classList.add('bg-chapter-1');
            } else if (currentLevel <= 12) {
                // THPT (Level 10-12)
                container.classList.add('bg-chapter-2');
            } else {
                // ƒê·∫°i h·ªçc (Level 13+)
                container.classList.add('bg-chapter-3');
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            initGame();
            // ƒê·∫£m b·∫£o load ƒë√∫ng background ngay khi v√†o game
            // Gi·∫£ s·ª≠ bi·∫øn global 'level' b·∫Øt ƒë·∫ßu t·ª´ 1
            if (typeof level !== 'undefined') {
                updateGameBackground(level);
            } else {
                updateGameBackground(1);
            }
        });
    </script>
</body>
</html>